<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SR LUDO | Premium Battle Arena</title>
  
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src *; style-src * 'unsafe-inline';">

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://www.phone.email/sign_in_button_v1.js" async></script>
  <style>
    :root {
      --bg: #040913;
      --card: #ffffff;
      --text: #e8efff;
      --text-dark: #1e293b;
      --muted: #9fb0d1;
      --line: rgba(255, 255, 255, 0.08);
      --accent: #2f7bff;
      --gold-1: #a86b00;
      --gold-2: #ffd05a;
      --danger: #ff3d4d;
      --shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: radial-gradient(1200px 500px at 50% -200px, #154b99 0%, var(--bg) 65%);
      color: var(--text);
      min-height: 100vh;
    }
    .hidden { display: none !important; }
    .app {
      max-width: 540px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
      background: #f1f5f9;
      padding-bottom: 90px;
    }

    /* --- SIDEBAR & OVERLAY (Original Features) --- */
    .sidebar {
      position: fixed; inset: 0 auto 0 0; width: 78%; max-width: 320px; background: #09172d;
      border-right: 1px solid var(--line); z-index: 200; transform: translateX(-100%); transition: transform 0.24s ease; padding: 16px;
    }
    .sidebar.open { transform: translateX(0); }
    .menu-link {
      display: block; color: var(--text); text-decoration: none; border: 1px solid var(--line); padding: 11px 12px;
      border-radius: 10px; margin-bottom: 10px; background: rgba(255,255,255,0.02); font-size: 14px;
    }
    .overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.65); z-index: 150; display: none; }
    .overlay.show { display: block; }

    /* --- HEADER (Original) --- */
    .sticky-header {
      position: sticky; top: 0; z-index: 100; background: #1e293b;
      padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; color: white;
    }
    .hamburger { border: none; background: none; color: white; font-size: 24px; cursor: pointer; }
    .nav-logo { height: 35px; }
    .wallets { display: flex; gap: 8px; }
    .pill {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 50px; padding: 5px 12px; font-size: 11px; text-align: center; min-width: 80px;
    }
    .pill strong { display: block; font-size: 14px; color: #ffd76c; }

    /* --- ANNOUNCEMENT (Image Style) --- */
    .announcement {
      background: linear-gradient(90deg, #0f172a, #1e293b);
      margin: 15px; padding: 15px; border-radius: 12px; border: 1.5px solid #ffd76c;
      color: white; text-align: center; font-size: 13px; font-weight: 500;
    }

    /* --- GAME GRID (Your Request) --- */
    .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px; }
    .game-card {
      background: white; border-radius: 15px; overflow: hidden; box-shadow: var(--shadow);
      position: relative; cursor: pointer; aspect-ratio: 1/1; border: 1px solid #e2e8f0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .game-card img { width: 100%; height: 100%; object-fit: cover; }
    .live-tag {
      position: absolute; top: 8px; right: 8px; background: white; color: #ff3d4d;
      font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 50px; display: flex; align-items: center; gap: 4px;
    }
    .live-dot { width: 6px; height: 6px; background: #ff3d4d; border-radius: 50%; animation: blink 1s infinite; }

    /* --- LOGIN & MODALS --- */
    .login-screen { height: 100vh; display: flex; align-items: center; justify-content: center; background: #0f172a; }
    .login-card { background: white; width: 90%; max-width: 400px; padding: 30px; border-radius: 20px; text-align: center; }
    .main-logo { height: 80px; margin-bottom: 20px; }
    .modal {
      position: fixed; left: 50%; top: 50%; width: min(92%, 460px); transform: translate(-50%, -50%);
      background: #0a1a32; border: 1px solid var(--line); border-radius: 14px; z-index: 300; padding: 16px;
      display: none; max-height: 70vh; overflow-y: auto; color: white;
    }
    .modal.show { display: block; }
    .record { border: 1px solid var(--line); border-radius: 10px; padding: 10px; margin-bottom: 8px; font-size: 12px; background: rgba(255,255,255,0.05); }

    /* --- BOTTOM NAV --- */
    .bottom-nav {
      position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
      width: min(540px, 100%); background: white; display: flex; justify-content: space-around;
      padding: 10px 0; border-top: 1px solid #e2e8f0; z-index: 100;
    }
    .nav-item { text-align: center; color: #64748b; text-decoration: none; font-size: 11px; flex: 1; }
    .nav-item.active { color: #2f7bff; }

    @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }
  </style>
</head>
<body>
  <div class="app">
    <section id="loginScreen" class="login-screen">
      <div class="login-card">
        <img src="logo.png" alt="SR Ludo" class="main-logo">
        <p style="color:var(--text-dark); margin-bottom: 20px;">Premium Battle Platform</p>
        <input id="referralCode" type="text" placeholder="Referral Code (Optional)" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 15px;">
        <button id="loginBtn" style="width:100%; background:#2f7bff; color:white; border:none; padding:12px; border-radius:8px; font-weight:700; cursor:pointer;">Continue with Phone</button>
        <div class="signin-wrap" style="margin-top: 15px;">
          <div class="pe_signin_button" data-client-id="17286597723145724436" data-theme="dark"></div>
        </div>
      </div>
    </section>

    <section id="dashboard" class="hidden">
      <header class="sticky-header">
        <button id="menuBtn" class="hamburger">‚ò∞</button>
        <img src="logo.png" alt="Logo" class="nav-logo">
        <div class="wallets">
          <div class="pill">Cash<strong id="cashAmount">0</strong></div>
          <div class="pill">Winning<strong id="winAmount">0</strong></div>
        </div>
      </header>

      <div class="announcement">
        üôè ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç SR Ludo ‡§´‡•à‡§Æ‡§ø‡§≤‡•Ä ‡§π‡§Æ‡•á‡§∂‡§æ ‡§Ü‡§™‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡•à‡•§ ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡§æ‡§à ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§§‡•ã‡•ú‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§ üòò
      </div>

      <div class="game-grid">
        <div class="game-card" id="classicCard">
          <div class="live-tag"><span class="live-dot"></span> LIVE</div>
          <img src="classic.png" alt="Ludo Classic">
        </div>
        
        <div class="game-card" onclick="window.location.href='https://wa.me/916261642944'">
          <div class="live-tag"><span class="live-dot"></span> LIVE</div>
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" style="width: 50%; height: auto; margin-bottom: 5px;">
          <strong style="color: var(--text-dark); font-size: 16px;">SUPPORT</strong>
        </div>
      </div>

      <div style="padding: 15px;">
        <img src="https://i.ibb.co/v6y8m6V/tournaments-banner.png" alt="Banner" style="width:100%; border-radius:12px; box-shadow:var(--shadow);">
      </div>

      <nav class="bottom-nav">
        <a href="#" class="nav-item active">üè†<br>Home</a>
        <a href="battles.html" class="nav-item">üéÆ<br>Battles</a>
        <a href="wallet.html" class="nav-item">üíº<br>Wallet</a>
        <a href="profile.html" class="nav-item">üë§<br>Profile</a>
      </nav>
    </section>
  </div>

  <aside id="sidebar" class="sidebar">
    <h4 style="color:white; margin-bottom:20px;">SR LUDO Menu</h4>
    <a href="#" class="menu-link" onclick="location.reload()">Home</a>
    <a href="#" class="menu-link history-link" data-type="match_history">Match History</a>
    <a href="#" class="menu-link history-link" data-type="deposit_history">Deposit History</a>
    <a href="#" class="menu-link history-link" data-type="withdraw_history">Withdraw History</a>
    <a href="wallet.html" class="menu-link">Wallet</a>
    <a href="profile.html" class="menu-link">Profile</a>
    <a href="#" class="menu-link" id="logoutBtn">Logout</a>
  </aside>
  <div id="overlay" class="overlay"></div>

  <section id="historyModal" class="modal">
    <h4 id="modalTitle" style="margin-top:0;">History</h4>
    <div id="historyList"></div>
    <button id="closeModalBtn" style="width:100%; padding:10px; margin-top:10px; background:#2f7bff; border:none; border-radius:8px; color:white;">Close</button>
  </section>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getDatabase, ref, get, set, update, onValue, query, limitToLast } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';

    const firebaseConfig = {
      apiKey: 'AIzaSyAx0fr47IsOtBxakcBj1ndwDYle_XlaE-Y',
      authDomain: 'sr-ludo-4440b.firebaseapp.com',
      databaseURL: 'https://sr-ludo-4440b-default-rtdb.firebaseio.com',
      projectId: 'sr-ludo-4440b',
      storageBucket: 'sr-ludo-4440b.firebasestorage.app',
      messagingSenderId: '1080387235822',
      appId: '1:1080387235822:web:77faea231641837950e8ff'
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const loginScreen = document.getElementById('loginScreen');
    const dashboard = document.getElementById('dashboard');
    const cashAmount = document.getElementById('cashAmount');
    const winAmount = document.getElementById('winAmount');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const historyModal = document.getElementById('historyModal');
    const historyList = document.getElementById('historyList');

    let currentPhone = localStorage.getItem('sr_ludo_phone');

    // Sidebar & Modal Functions
    const toggleSidebar = (show) => { sidebar.classList.toggle('open', show); overlay.classList.toggle('show', show); };
    const showHistory = async (type) => {
      if (!currentPhone) return;
      document.getElementById('modalTitle').textContent = type.replace('_', ' ').toUpperCase();
      historyList.innerHTML = '<p>Loading records...</p>';
      historyModal.classList.add('show');
      overlay.classList.add('show');
      
      const snap = await get(query(ref(db, `${type}/${currentPhone}`), limitToLast(15)));
      const list = snap.val();
      if (!list) { historyList.innerHTML = 'No records found.'; return; }
      
      historyList.innerHTML = Object.entries(list).reverse().map(([id, item]) => 
        `<div class="record">#${id.slice(-6)} - ‚Çπ${item.amount || item.entry_fee || 0} [${item.status || 'Success'}]</div>`
      ).join('');
    };

    // User Session
    const initUser = async (phone) => {
      const userRef = ref(db, `users/${phone}`);
      onValue(userRef, (s) => {
        const u = s.val() || {};
        cashAmount.textContent = u.balance || 0;
        winAmount.textContent = u.win_balance || 0;
      });
      loginScreen.classList.add('hidden');
      dashboard.classList.remove('hidden');
    };

    // Event Handlers
    document.getElementById('menuBtn').onclick = () => toggleSidebar(true);
    overlay.onclick = () => { toggleSidebar(false); historyModal.classList.remove('show'); overlay.classList.remove('show'); };
    document.getElementById('closeModalBtn').onclick = () => { historyModal.classList.remove('show'); overlay.classList.remove('show'); };
    document.getElementById('classicCard').onclick = () => window.location.href = 'battles.html';
    document.getElementById('logoutBtn').onclick = () => { localStorage.clear(); location.reload(); };
    
    document.querySelectorAll('.history-link').forEach(link => {
      link.onclick = (e) => { e.preventDefault(); showHistory(link.dataset.type); toggleSidebar(false); };
    });

    // Login Callback
    window.phoneEmailListener = (userObj) => {
      if (userObj.phone_no) {
        localStorage.setItem('sr_ludo_phone', userObj.phone_no);
        location.reload();
      }
    };

    if (currentPhone) initUser(currentPhone);
  </script>
</body>
</html>
